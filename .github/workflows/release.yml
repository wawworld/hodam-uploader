name: Create Release

on:
  push:
    tags:
      - 'v*.*.*'  # v1.0.0 ê°™ì€ íƒœê·¸ê°€ pushë˜ë©´ ì‹¤í–‰

jobs:
  build-and-release:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Install Playwright browsers
      run: |
        playwright install chromium
    
    - name: Get version from tag
      id: get_version
      run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
      shell: bash
    
    - name: Build EXE with PyInstaller
      run: |
        pyinstaller --onefile --name hodam_uploader hodam_uploader.py
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: dist/hodam_uploader.exe
        body: |
          ## ğŸ‰ í˜¸ì„œëŒ€í•™êµ Cando ìë™ ìƒë‹´ ì…ë ¥ í”„ë¡œê·¸ë¨ ${{ steps.get_version.outputs.VERSION }}
          
          ### ğŸ“¥ ë‹¤ìš´ë¡œë“œ
          ì•„ë˜ Assetsì—ì„œ `hodam_uploader.exe` ë‹¤ìš´ë¡œë“œ
          
          ### ğŸ“– ì‚¬ìš© ë°©ë²•
          ìì„¸í•œ ë‚´ìš©ì€ [README](https://github.com/wawworld/hodam-uploader/blob/main/README.md) ì°¸ì¡°
          
          ### âœ¨ ì£¼ìš” ê¸°ëŠ¥
          - CSV íŒŒì¼ ê¸°ë°˜ ëŒ€ëŸ‰ ìƒë‹´ ë°ì´í„° ìë™ ì…ë ¥
          - ë¸Œë¼ìš°ì € ìë™í™”ë¡œ ë°˜ë³µ ì‘ì—… ì œê±°
          - ì‹œìŠ¤í…œ Chrome ë¸Œë¼ìš°ì € ìë™ ì—°ê²°
          - ìƒì„¸í•œ ì²˜ë¦¬ ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„±
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
